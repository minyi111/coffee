<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Global Coffee Insight Map</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.28/esri/themes/dark/main.css">
  <script src="https://js.arcgis.com/4.28/"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "Segoe UI", sans-serif;
      background-color: #1f1f1f;
      color: white;
    }
    .container {
      display: flex;
      height: 100%;
    }

    #left-panel {
      width: 250px;
      background: #2a2a2a;
      padding: 16px;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.3);
    }

    #left-panel h2 {
      font-size: 18px;
      color: #fff;
      margin-bottom: 12px;
    }

    #map {
      flex: 1;
      height: 100%;
      position: relative;
    }

    #right-panel {
      width: 360px;
      background: #2a2a2a;
      padding: 16px;
      overflow-y: auto;
    }

    canvas {
      margin-top: 16px;
      background-color: #1f1f1f;
    }

    select, button {
      width: 100%;
      margin-bottom: 12px;
      padding: 8px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      background: #444;
      color: white;
    }

    #map-switch {
      margin-top: 20px;
    }

    .chart-title {
      font-size: 16px;
      color: #8a2be2;
      margin-top: 10px;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å·¦ä¾§é¢æ¿ -->
    <div id="left-panel">
      <h2>â˜• Coffee Map Panel</h2>
      <select id="coffeeType">
        <option>All</option>
        <option>Starbucks</option>
        <option>Luckin</option>
        <option>Tim Hortons</option>
      </select>
      <select id="yearSelect">
        <option>All</option>
        <option>2022</option>
        <option>2023</option>
      </select>
      <label for="yearSlider">Year Slider</label>
      <input type="range" id="yearSlider" min="2010" max="2023" value="2022">
      <div id="map-switch">
        <button onclick="loadWebMap('909ccff2f308451ca3d47aa968928a3b')">åº—é“ºä½ç½®åœ°å›¾</button>
        <button onclick="loadWebMap('7a7a761019c744af8fe5a4315c3a1da2')">Google Trends åœ°å›¾</button>
      </div>
    </div>

    <!-- ä¸­é—´åœ°å›¾åŒºåŸŸ -->
    <div id="map"></div>

    <!-- å³ä¾§å›¾è¡¨åŒºåŸŸ -->
    <div id="right-panel">
      <div>
        <div class="chart-title">ğŸ“Š é—¨åº—æ•°é‡ Top 5</div>
        <canvas id="barChart" height="160"></canvas>

        <div class="chart-title">ğŸŒ å“ç‰Œå…¨çƒå æ¯”</div>
        <canvas id="pieChart" height="200"></canvas>
      </div>
    </div>
  </div>

  <script>
    let view;

    function loadWebMap(mapId) {
      require(["esri/WebMap", "esri/views/MapView"], (WebMap, MapView) => {
        if (view) {
          view.container = null;
          view.destroy();
        }

        const webmap = new WebMap({
          portalItem: { id: mapId }
        });

        view = new MapView({
          container: "map",
          map: webmap,
          center: [103.8, 1.35], // é»˜è®¤æ–°åŠ å¡
          zoom: 2
        });
      });
    }

    // é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªåœ°å›¾
    window.onload = function () {
      loadWebMap("909ccff2f308451ca3d47aa968928a3b");
      loadCharts();
    };

    // ç¤ºä¾‹å›¾è¡¨æ•°æ®ï¼ˆå¯ä»¥æ¢æˆçœŸå®é—¨åº—æ•°é‡æ•°æ®ï¼‰
    function loadCharts() {
      new Chart(document.getElementById("barChart"), {
        type: "bar",
        data: {
          labels: ["Starbucks", "Luckin", "Tim Hortons", "Costa", "McCafe"],
          datasets: [{
            label: "é—¨åº—æ•°é‡",
            backgroundColor: "#8a2be2",
            data: [32000, 11000, 8000, 5000, 3000]
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: {
            x: { ticks: { color: "white" } },
            y: { ticks: { color: "white" } }
          }
        }
      });

      new Chart(document.getElementById("pieChart"), {
        type: "pie",
        data: {
          labels: ["Starbucks", "Luckin", "Tim Hortons", "Costa", "McCafe"],
          datasets: [{
            label: "å¸‚åœºå æ¯”",
            data: [55, 20, 15, 5, 5],
            backgroundColor: [
              "#8a2be2", "#5cacee", "#ffa07a", "#20b2aa", "#ffcc00"
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { labels: { color: "white" } } }
        }
      });
    }
  </script>
</body>
</html>
